  <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Aplicaci√≥n Completa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f0f2f5; }
    .panel { background: #fff; border-radius: .5rem; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .edit-btn, .delete-btn { visibility: hidden; }
    .manage-mode .edit-btn, .manage-mode .delete-btn { visibility: visible; }
    .flex-center { display: flex; justify-content: space-between; align-items: center; }
  </style>
</head>
<body>
  <div class="container py-4">

    <!-- Bot√≥n gestionar -->
    <div class="mb-4 text-end">
      <button id="manageBtn" class="btn btn-warning">Gestionar (‚úé / üóëÔ∏è)</button>
    </div>

    <!-- 1) REGISTRO DE INGRESOS -->
    <div class="panel" id="incomePanel">
      <h4>Registro de Ingresos</h4>
      <form id="incomeForm" class="row g-2 mb-3">
        <div class="col-md-2"><input type="date" id="incomeDate" class="form-control" required></div>
        <div class="col-md-4"><input type="text" id="incomeConcept" class="form-control" placeholder="Concepto" required></div>
        <div class="col-md-2"><input type="number" step="0.01" id="incomeAmount" class="form-control" placeholder="Monto" required></div>
        <div class="col-md-2"><button type="submit" class="btn btn-success w-100">Agregar</button></div>
      </form>
      <table class="table table-sm">
        <thead><tr><th>Fecha</th><th>Concepto</th><th>Monto</th><th>Acciones</th></tr></thead>
        <tbody id="incomesList"></tbody>
      </table>
    </div>

    <!-- 2) REGISTRO DE EGRESOS -->
    <div class="panel" id="expensePanel">
      <h4>Registro de Egresos</h4>
      <form id="expenseForm" class="row g-2 mb-3">
        <div class="col-md-2"><input type="date" id="expenseDate" class="form-control" required></div>
        <div class="col-md-6"><input type="text" id="expenseConcept" class="form-control" placeholder="Concepto" required></div>
        <div class="col-md-2"><input type="number" step="0.01" id="expenseAmount" class="form-control" placeholder="Monto" required></div>
        <div class="col-md-2"><button type="submit" class="btn btn-danger w-100">Agregar</button></div>
      </form>
      <table class="table table-sm">
        <thead><tr><th>Fecha</th><th>Concepto</th><th>Monto</th><th>Acciones</th></tr></thead>
        <tbody id="expensesList"></tbody>
      </table>
    </div>

    <!-- 3) B√öSQUEDA POR FECHA -->
    <div class="panel" id="searchPanel">
      <h4>Buscar por Fecha</h4>
      <div class="row g-2 mb-3">
        <div class="col-md-3"><input type="date" id="searchDate" class="form-control"></div>
        <div class="col-md-2"><button id="btnSearch" class="btn btn-primary w-100">Buscar</button></div>
        <div class="col-md-2"><button id="btnClear" class="btn btn-secondary w-100">Limpiar</button></div>
      </div>
      <table class="table table-sm">
        <thead><tr><th>Ingreso</th><th>Egreso</th><th>Saldo</th></tr></thead>
        <tbody id="searchResults"></tbody>
      </table>
    </div>

    <!-- 4) INVENTARIO -->
    <div class="panel" id="inventarioSection">
      <h4>Inventario</h4>
      <form id="formInventario" class="row g-2 mb-3">
        <div class="col-md-2"><input type="text" id="itemInv" class="form-control" placeholder="Item" required></div>
        <div class="col-md-2"><input type="text" id="codigoInv" class="form-control" placeholder="C√≥digo" required></div>
        <div class="col-md-4"><input type="text" id="nombreInv" class="form-control" placeholder="Nombre" required></div>
        <div class="col-md-2"><input type="number" id="unidadesInv" class="form-control" placeholder="Unidades" required></div>
        <div class="col-md-2"><button type="submit" class="btn btn-primary w-100">Agregar</button></div>
      </form>
      <table class="table table-sm text-center">
        <thead><tr><th>Item</th><th>C√≥digo</th><th>Nombre</th><th>Unidades</th><th>Acciones</th></tr></thead>
        <tbody id="inventarioBody"></tbody>
      </table>
    </div>

    <!-- 5) GESTI√ìN DE MERCADER√çA -->
    <div class="panel" id="gestionSection">
      <h4>üì¶ Gesti√≥n de Mercader√≠a</h4>
      <form id="formGestion" class="row g-2 mb-3">
        <div class="col-md-3"><input type="text" id="prodG" class="form-control" placeholder="Producto" required></div>
        <div class="col-md-2"><input type="number" id="ingresoG" class="form-control" placeholder="Ingreso" readonly></div>
        <div class="col-md-2"><input type="number" step="0.01" id="costoG" class="form-control" placeholder="Costo" required></div>
        <div class="col-md-1"><input type="number" id="ventaG" class="form-control" placeholder="Venta" required></div>
        <div class="col-md-2"><input type="number" step="0.01" id="precioVentaG" class="form-control" placeholder="Precio Venta" required></div>
        <div class="col-md-1"><input type="number" id="saldoG" class="form-control" placeholder="Saldo" readonly></div>
        <div class="col-md-1"><button type="submit" class="btn btn-success w-100">+ Agregar</button></div>
      </form>
      <table class="table table-sm text-center">
        <thead class="table-dark"><tr>
          <th>#</th><th>Producto</th><th>Ingreso</th><th>Costo</th><th>Venta</th>
          <th>Precio Venta</th><th>Saldo</th><th>Acciones</th>
        </tr></thead>
        <tbody id="gestionBody"></tbody>
      </table>
    </div>

  </div>

  <script>
    const PASSWORD = 'fernandez123';
    let manageMode = false;
    const container = document.querySelector('.container');

    document.getElementById('manageBtn').onclick = () => {
      if (!manageMode) {
        const pass = prompt('Contrase√±a:');
        if (pass === PASSWORD) {
          manageMode = true;
          container.classList.add('manage-mode');
          document.getElementById('manageBtn').textContent = 'Salir Gesti√≥n';
        }
      } else {
        manageMode = false;
        container.classList.remove('manage-mode');
        document.getElementById('manageBtn').textContent = 'Gestionar (‚úé / üóëÔ∏è)';
      }
    };

    // LocalStorage keys
    const KEY_INC = 'app_incomes', KEY_EXP = 'app_expenses', KEY_INV = 'app_inventory', KEY_GES = 'app_gestion';
    let incomes   = JSON.parse(localStorage.getItem(KEY_INC)) || [];
    let expenses  = JSON.parse(localStorage.getItem(KEY_EXP))|| [];
    let inventory = JSON.parse(localStorage.getItem(KEY_INV)) || [];
    let gestion   = JSON.parse(localStorage.getItem(KEY_GES))|| [];

    // Helpers
    const $ = id=>document.getElementById(id);
    function saveAll(){
      localStorage.setItem(KEY_INC, JSON.stringify(incomes));
      localStorage.setItem(KEY_EXP, JSON.stringify(expenses));
      localStorage.setItem(KEY_INV, JSON.stringify(inventory));
      localStorage.setItem(KEY_GES, JSON.stringify(gestion));
    }

    // 1) Ingresos
    function renderIncomes(){
      const tbody = $('incomesList'); tbody.innerHTML = '';
      incomes.forEach((i, idx) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${i.date}</td>
          <td>${i.concept}</td>
          <td>$${i.amount.toFixed(2)}</td>
          <td>
            <button class="btn btn-sm btn-primary edit-btn" onclick="editIncome(${idx})">‚úé</button>
            <button class="btn btn-sm btn-danger delete-btn" onclick="deleteIncome(${idx})">üóëÔ∏è</button>
          </td>`;
        tbody.append(row);
      });
    }
    $('incomeForm').onsubmit = e=>{
      e.preventDefault();
      incomes.push({ date: $('incomeDate').value,
                     concept: $('incomeConcept').value,
                     amount: parseFloat($('incomeAmount').value) });
      saveAll(); renderIncomes(); renderSummary(); e.target.reset();
    };
    window.editIncome = idx => {
      const i = incomes[idx];
      const d = prompt('Fecha',i.date); if(!d) return;
      const c = prompt('Concepto',i.concept); if(c===null) return;
      const a = parseFloat(prompt('Monto',i.amount)); if(isNaN(a)) return;
      incomes[idx] = { date:d, concept:c, amount:a };
      saveAll(); renderIncomes(); renderSummary();
    };
    window.deleteIncome = idx => {
      if(confirm('Eliminar ingreso?')){
        incomes.splice(idx,1);
        saveAll(); renderIncomes(); renderSummary();
      }
    };

    // 2) Egresos
    function renderExpenses(){
      const tbody = $('expensesList'); tbody.innerHTML = '';
      expenses.forEach((e, idx) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${e.date}</td>
          <td>${e.concept}</td>
          <td>$${e.amount.toFixed(2)}</td>
          <td>
            <button class="btn btn-sm btn-primary edit-btn" onclick="editExpense(${idx})">‚úé</button>
            <button class="btn btn-sm btn-danger delete-btn" onclick="deleteExpense(${idx})">üóëÔ∏è</button>
          </td>`;
        tbody.append(row);
      });
    }
    $('expenseForm').onsubmit = e=>{
      e.preventDefault();
      expenses.push({ date: $('expenseDate').value,
                      concept: $('expenseConcept').value,
                      amount: parseFloat($('expenseAmount').value) });
      saveAll(); renderExpenses(); renderSummary(); e.target.reset();
    };
    window.editExpense = idx => {
      const ex = expenses[idx];
      const d  = prompt('Fecha',ex.date); if(!d) return;
      const c  = prompt('Concepto',ex.concept); if(c===null) return;
      const a  = parseFloat(prompt('Monto',ex.amount)); if(isNaN(a)) return;
      expenses[idx] = { date:d, concept:c, amount:a };
      saveAll(); renderExpenses(); renderSummary();
    };
    window.deleteExpense = idx => {
      if(confirm('Eliminar egreso?')){
        expenses.splice(idx,1);
        saveAll(); renderExpenses(); renderSummary();
      }
    };

    // 3) Resumen por Fecha
    function renderSummary(){
      const tbody = $('searchResults'); tbody.innerHTML = '';
      const dates = new Set([...incomes.map(i=>i.date), ...expenses.map(e=>e.date)]);
      Array.from(dates).sort().forEach(date => {
        const inc = incomes.filter(i=>i.date===date).reduce((s,i)=>s+i.amount,0);
        const exp = expenses.filter(e=>e.date===date).reduce((s,e)=>s+e.amount,0);
        const saldo = inc - exp;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${date}</td>
          <td>$${inc.toFixed(2)}</td>
          <td>$${exp.toFixed(2)}</td>
          <td>$${saldo.toFixed(2)}</td>`;
        tbody.append(tr);
      });
    }
    $('btnSearch').onclick = ()=>{
      const d = $('searchDate').value;
      const inc = incomes.filter(i=>i.date===d).reduce((s,i)=>s+i.amount,0);
      const exp = expenses.filter(e=>e.date===d).reduce((s,e)=>s+e.amount,0);
      const saldo = inc - exp;
      const tbody = $('searchResults'); tbody.innerHTML = `
        <tr>
          <td>$${inc.toFixed(2)}</td>
          <td>$${exp.toFixed(2)}</td>
          <td>$${saldo.toFixed(2)}</td>
        </tr>`;
    };
    $('btnClear').onclick = ()=>{ $('searchDate').value=''; renderSummary(); };

    // 4) Inventario
    function renderInv(){
      const tbody = $('inventarioBody'); tbody.innerHTML = '';
      inventory.forEach((v,i)=>{
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${v.item}</td><td>${v.codigo}</td><td>${v.nombre}</td><td>${v.unidades}</td>
          <td>
            <button class="btn btn-sm btn-primary edit-btn" onclick="editInv(${i})">‚úé</button>
            <button class="btn btn-sm btn-danger delete-btn" onclick="deleteInv(${i})">üóëÔ∏è</button>
          </td>`;
        tbody.append(row);
      });
    }
    $('formInventario').onsubmit = e=>{
      e.preventDefault();
      inventory.push({
        item:     $('itemInv').value,
        codigo:   $('codigoInv').value,
        nombre:   $('nombreInv').value,
        unidades: parseInt($('unidadesInv').value,10)
      });
      saveAll(); renderInv(); e.target.reset();
    };
    window.editInv = idx => {
      const v = inventory[idx];
      $('itemInv').value     = v.item;
      $('codigoInv').value   = v.codigo;
      $('nombreInv').value   = v.nombre;
      $('unidadesInv').value = v.unidades;
      inventory.splice(idx,1);
      saveAll(); renderInv();
    };
    window.deleteInv = idx => {
      if(confirm('Eliminar inventario?')){
        inventory.splice(idx,1);
        saveAll(); renderInv();
      }
    };

    // 5) Gesti√≥n de Mercader√≠a
    function renderGestion(){
      const tbody = $('gestionBody'); tbody.innerHTML = '';
      gestion.forEach((g,i)=>{
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${i+1}</td>
          <td>${g.producto}</td>
          <td>${g.ingreso}</td>
          <td>S/ ${g.costo.toFixed(2)}</td>
          <td>${g.venta}</td>
          <td>S/ ${g.precioVenta.toFixed(2)}</td>
          <td>${g.saldo}</td>
          <td>
            <button class="btn btn-sm btn-primary edit-btn" onclick="editGestion(${i})">‚úé</button>
            <button class="btn btn-sm btn-danger delete-btn" onclick="deleteGestion(${i})">üóëÔ∏è</button>
          </td>`;
        tbody.append(row);
      });
    }
    $('formGestion').onsubmit = e=>{
      e.preventDefault();
      const prod = $('prodG').value;
      const venta = parseInt($('ventaG').value,10);
      const ingresoTot = incomes.filter(i=>i.concept===prod).reduce((s,i)=>s+i.amount,0);
      // descontar del inventario
      const inv = inventory.find(x=>x.nombre===prod);
      if(inv){ inv.unidades = Math.max(0, inv.unidades - venta);}
      // saldo = ingreso - egreso
      const egTot = expenses.filter(e=>e.concept===prod).reduce((s,e)=>s+e.amount,0);
      const saldo = ingresoTot - egTot;
      gestion.push({
        producto: prod,
        ingreso: ingresoTot,
        costo: parseFloat($('costoG').value),
        venta: venta,
        precioVenta: parseFloat($('precioVentaG').value),
        saldo: saldo
      });
      saveAll();
      renderInv();
      renderGestion();
      e.target.reset();
    };
    window.editGestion = i => {
      const g = gestion.splice(i,1)[0];
      $('prodG').value       = g.producto;
      $('ingresoG').value    = g.ingreso;
      $('costoG').value      = g.costo;
      $('ventaG').value      = g.venta;
      $('precioVentaG').value= g.precioVenta;
      $('saldoG').value      = g.saldo;
      saveAll(); renderGestion();
    };
    window.deleteGestion = i => {
      if(confirm('Eliminar gesti√≥n?')){
        gestion.splice(i,1);
        saveAll(); renderGestion();
      }
    };

    // Inicial
    function renderAll(){
      renderIncomes();
      renderExpenses();
      renderSummary();
      renderInv();
      renderGestion();
    }
    window.onload = renderAll;
  </script>
</body>
</html>


