  <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Balance + Inventario y Gestión</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .panel { background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 15px; }
    .total { margin-top:10px; font-weight:bold; }
    .sidebar { position: fixed; top: 0; left: 0; width: 250px; height: 100%; background: #343a40; color: #fff; padding-top: 20px; transition: left .3s ease; z-index:1000; }
    .sidebar.show { left: 0; }
    .sidebar a { color: #fff; padding: 10px 20px; display: block; text-decoration: none; }
    .sidebar a:hover { background: #495057; }
    .hamburger { display: none; position: absolute; top: 20px; left: 20px; font-size: 30px; background: none; border: none; cursor: pointer; z-index:1100; color: #343a40; }
    @media(max-width:767px) { .sidebar { left: -250px; } .hamburger { display: block; } }
    .content { margin-left: 260px; padding: 20px; }
    .card { margin-bottom: 2rem; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
    .edit-btn, .delete-btn { visibility: hidden; }
  </style>
</head>
<body>

  <button class="hamburger" id="hamburgerMenu">☰</button>
  <nav class="sidebar" id="sidebarNav">
    <h3 class="text-center text-white">𝐌𝐆 𝐀𝐔𝐓𝐎𝐌𝐎𝐓𝐑𝐈𝐙</h3>
    <a href="#incomePanel">Ingresos</a>
    <a href="#expensePanel">Egresos</a>
    <a href="#inventarioSection">Inventario</a>
  </nav>

  <main class="content">
    <div class="container">

      <!-- Botón gestión -->
      <div class="text-right mb-3">
        <button class="btn btn-warning" id="manageBtn">Gestionar (editar/eliminar)</button>
      </div>

      <!-- Ingresos -->
      <section class="panel" id="incomePanel">
        <h3>Registro de Ingresos</h3>
        <form id="incomeForm" class="form-row mb-3">
          <input type="date" id="incomeDate" class="form-control col-md-2" required>
          <input type="text" id="incomeConcept" class="form-control col-md-4" placeholder="Concepto" required>
          <input type="text" id="incomeDocType" class="form-control col-md-3" placeholder="Tipo de Doc" required>
          <input type="number" step="0.01" id="incomeAmount" class="form-control col-md-1" placeholder="Monto" required>
          <button type="submit" class="btn btn-success col-md-2">Agregar</button>
        </form>
        <div id="totalIncome" class="total">Total Ingresos: $0</div>
        <table class="table table-sm mt-2">
          <thead><tr><th>Fecha</th><th>Concepto</th><th>Tipo Doc</th><th>Monto</th><th>Acciones</th></tr></thead>
          <tbody id="incomesList"></tbody>
        </table>
      </section>

      <!-- Egresos -->
      <section class="panel" id="expensePanel">
        <h3>Registro de Egresos</h3>
        <form id="expenseForm" class="form-row mb-3">
          <input type="date" id="expenseDate" class="form-control col-md-3" required>
          <input type="text" id="expenseConcept" class="form-control col-md-5" placeholder="Concepto" required>
          <input type="number" step="0.01" id="expenseAmount" class="form-control col-md-1" placeholder="Monto" required>
          <button type="submit" class="btn btn-danger col-md-3">Agregar</button>
        </form>
        <div id="totalExpense" class="total">Total Egresos: $0</div>
        <table class="table table-sm mt-2">
          <thead><tr><th>Fecha</th><th>Concepto</th><th>Monto</th><th>Acciones</th></tr></thead>
          <tbody id="expensesList"></tbody>
        </table>
      </section>

      <!-- Inventario -->
      <div class="card p-4" id="inventarioSection">
        <h3>Inventario</h3>
        <form id="formInventario" class="row g-3 mb-3">
          <div class="col-md-2"><input type="text" id="itemInv" class="form-control" placeholder="Item" required></div>
          <div class="col-md-2"><input type="text" id="codigoInv" class="form-control" placeholder="Código" required></div>
          <div class="col-md-4"><input type="text" id="nombreInv" class="form-control" placeholder="Nombre" required></div>
          <div class="col-md-2"><input type="number" id="unidadesInv" class="form-control" placeholder="Unidades" required></div>
          <div class="col-md-2"><button type="submit" class="btn btn-primary w-100">Agregar Inventario</button></div>
        </form>
        <div class="table-responsive">
          <table class="table table-striped table-bordered text-center">
            <thead class="table-dark">
              <tr>
                <th>Item</th><th>Código</th><th>Nombre</th><th>Unidades</th><th>Acciones</th>
              </tr>
            </thead>
            <tbody id="inventarioBody"></tbody>
          </table>
        </div>
      </div>

    </div>
  </main>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  <script>
    // contraseña para gestionar
    const PASSWORD = 'fernandez123';
    let manageMode = false;
    const manageBtn = document.getElementById('manageBtn');
    manageBtn.onclick = () => {
      if (manageMode) {
        manageMode = false;
        manageBtn.textContent = 'Gestionar (editar/eliminar)';
      } else {
        const pass = prompt('Ingrese contraseña:');
        if (pass === PASSWORD) {
          manageMode = true;
          manageBtn.textContent = 'Salir gestionar';
        } else {
          return alert('Contraseña incorrecta');
        }
      }
      renderAll();
    };

    // toggle sidebar
    document.getElementById('hamburgerMenu').onclick = () =>
      document.getElementById('sidebarNav').classList.toggle('show');

    // --- DATOS ---
    const KEY_INC = 'balance_incomes', KEY_EXP = 'balance_expenses', KEY_INV = 'inv';
    let incomes   = JSON.parse(localStorage.getItem(KEY_INC))  || [];
    let expenses  = JSON.parse(localStorage.getItem(KEY_EXP)) || [];
    let inventario= JSON.parse(localStorage.getItem(KEY_INV)) || [];

    // Elementos
    const incomesList   = document.getElementById('incomesList');
    const expensesList  = document.getElementById('expensesList');
    const inventarioBody= document.getElementById('inventarioBody');
    const totalIncome   = document.getElementById('totalIncome');
    const totalExpense  = document.getElementById('totalExpense');

    // Guardar
    function saveAll() {
      localStorage.setItem(KEY_INC, JSON.stringify(incomes));
      localStorage.setItem(KEY_EXP, JSON.stringify(expenses));
      localStorage.setItem(KEY_INV, JSON.stringify(inventario));
    }

    // Render Ingresos
    function renderIncomes() {
      incomesList.innerHTML = '';
      incomes.forEach((i, idx) => {
        let row = `<tr>
          <td>${i.date}</td><td>${i.concept}</td><td>${i.docType}</td><td>$${i.amount.toFixed(2)}</td>`;
        row += `<td>
          <button class="btn btn-sm btn-primary edit-btn" onclick="editIncome(${idx})">✎</button>
          <button class="btn btn-sm btn-danger delete-btn" onclick="deleteIncome(${idx})">🗑️</button>
        </td></tr>`;
        incomesList.insertAdjacentHTML('beforeend', row);
      });
      totalIncome.textContent = `Total Ingresos: $${incomes.reduce((s,x)=>s+x.amount,0).toFixed(2)}`;
    }

    // Render Egresos
    function renderExpenses() {
      expensesList.innerHTML = '';
      expenses.forEach((e, idx) => {
        let row = `<tr>
          <td>${e.date}</td><td>${e.concept}</td><td>$${e.amount.toFixed(2)}</td>`;
        row += `<td>
          <button class="btn btn-sm btn-primary edit-btn" onclick="editExpense(${idx})">✎</button>
          <button class="btn btn-sm btn-danger delete-btn" onclick="deleteExpense(${idx})">🗑️</button>
        </td></tr>`;
        expensesList.insertAdjacentHTML('beforeend', row);
      });
      totalExpense.textContent = `Total Egresos: $${expenses.reduce((s,x)=>s+x.amount,0).toFixed(2)}`;
    }

    // Render Inventario
    function renderInv() {
      inventarioBody.innerHTML = '';
      inventario.forEach((v, i) => {
        let row = `<tr>
          <td>${v.item}</td><td>${v.codigo}</td><td>${v.nombre}</td><td>${v.unidades}</td>`;
        row += `<td>
          <button class="btn btn-sm btn-primary edit-btn" onclick="editInv(${i})">✎</button>
          <button class="btn btn-sm btn-danger delete-btn" onclick="deleteInv(${i})">🗑️</button>
        </td></tr>`;
        inventarioBody.insertAdjacentHTML('beforeend', row);
      });
    }

    // Edit/Delete Ingresos
    window.editIncome = idx => {
      const i = incomes[idx];
      const d = prompt('Fecha', i.date);   if(!d) return;
      const c = prompt('Concepto', i.concept); if(c===null) return;
      const dt= prompt('Tipo Doc', i.docType); if(dt===null) return;
      const a = parseFloat(prompt('Monto', i.amount)); if(isNaN(a)) return;
      incomes[idx] = { date:d, concept:c, docType:dt, amount:a };
      saveAll(); renderAll();
    };
    window.deleteIncome = idx => {
      if(confirm('Eliminar ingreso?')) { incomes.splice(idx,1); saveAll(); renderAll(); }
    };

    // Edit/Delete Egresos
    window.editExpense = idx => {
      const e = expenses[idx];
      const d = prompt('Fecha', e.date);   if(!d) return;
      const c = prompt('Concepto', e.concept); if(c===null) return;
      const a = parseFloat(prompt('Monto', e.amount)); if(isNaN(a)) return;
      expenses[idx] = { date:d, concept:c, amount:a };
      saveAll(); renderAll();
    };
    window.deleteExpense = idx => {
      if(confirm('Eliminar egreso?')) { expenses.splice(idx,1); saveAll(); renderAll(); }
    };

    // Edit/Delete Inventario
    window.editInv = idx => {
      const v = inventario[idx];
      document.getElementById('itemInv').value     = v.item;
      document.getElementById('codigoInv').value   = v.codigo;
      document.getElementById('nombreInv').value   = v.nombre;
      document.getElementById('unidadesInv').value = v.unidades;
      inventario.splice(idx,1);
      saveAll(); renderAll();
    };
    window.deleteInv = idx => {
      if(confirm('Eliminar inventario?')) { inventario.splice(idx,1); saveAll(); renderAll(); }
    };

    // Formularios
    document.getElementById('incomeForm').onsubmit = e => {
      e.preventDefault();
      incomes.push({
        date: document.getElementById('incomeDate').value,
        concept: document.getElementById('incomeConcept').value,
        docType: document.getElementById('incomeDocType').value,
        amount: parseFloat(document.getElementById('incomeAmount').value)
      });
      saveAll(); renderAll(); e.target.reset();
    };
    document.getElementById('expenseForm').onsubmit = e => {
      e.preventDefault();
      expenses.push({
        date: document.getElementById('expenseDate').value,
        concept: document.getElementById('expenseConcept').value,
        amount: parseFloat(document.getElementById('expenseAmount').value)
      });
      saveAll(); renderAll(); e.target.reset();
    };
    document.getElementById('formInventario').onsubmit = e => {
      e.preventDefault();
      inventario.push({
        item: document.getElementById('itemInv').value,
        codigo: document.getElementById('codigoInv').value,
        nombre: document.getElementById('nombreInv').value,
        unidades: parseInt(document.getElementById('unidadesInv').value,10)
      });
      saveAll(); renderAll(); e.target.reset();
    };

    // Render all
    function renderAll() {
      renderIncomes();
      renderExpenses();
      renderInv();
      document.querySelectorAll('.edit-btn, .delete-btn').forEach(b=>{
        b.style.visibility = manageMode ? 'visible' : 'hidden';
      });
    }
    window.onload = renderAll;
  </script>
</body>
</html>

